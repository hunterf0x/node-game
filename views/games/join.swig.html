{% extends '../layout.swig.html' %}



{% block title %}
    Juego
{% endblock %}
{% block content %}
    <script>
        $(document).ready(function() {
            var socket = io.connect("");
            var content = $('#content');

            socket.on('connect', function() {
                console.log('connected');
                socket.emit('publish', 'game.{{ data.gameid }}.user',
                        JSON.stringify({nick: "{{ data.nick }}", ts: Date.now() })
                );
            });

            socket.on('message', function(message, data){
                content.prepend(message + '<br />' + data);
            }) ;

            socket.on('disconnect', function() {
                console.log('disconnected');
                content.html("<b>Disconnected!</b>");
            });


            $("#subscribe").submit(function() {
                socket.emit('psubscribe', $('#subscribe #channel').val());
                return false;
            });

            $(".action").click(function() {
                socket.emit('publish', 'game.{{ data.gameid }}.action.' + $(this).data('action'),
                        JSON.stringify({ nick: "{{ data.nick }}", ts: Date.now() })
                );
                return false;
            });

            $('body').keyup(function(e) {
                if(e.keyCode == 37){ //left
                    $(".action[data-action='left']").trigger('click');
                }else if(e.keyCode == 38){ // up
                    $(".action[data-action='up']").trigger('click');
                }else if(e.keyCode == 39){ // right
                    $(".action[data-action='right']").trigger('click');
                }else if(e.keyCode == 40){ // down
                    $(".action[data-action='hi']").trigger('click');
                }
            });
        });

    </script>
    <h1 class="title">Dance , Dance!</h1>
    <div data-action="left" class="action">Clap Your Hands (&larr;)</div>
    <div data-action="right" class="action">Play the Guitar (&rarr;)</div>
    <div data-action="up" class="action">Jump! Jump! (&uarr;)</div>
    <div data-action="hi" class="action">Play the Drums (&darr;)</div>

{% endblock %}
